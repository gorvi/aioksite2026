# 测试结果算法分析与优化建议

## 一、SCL-90 算法分析

### 当前实现

```typescript
// 总均分计算
总均分 = 90题总分 ÷ 90

// 因子得分计算
因子得分 = 该维度题目总分 ÷ 该维度题目数

// 总体状态判断
< 2.0：心理状态整体稳定
2.0-2.9：存在一定心理压力，建议关注
≥ 3.0：心理困扰较明显，建议寻求专业支持
```

### 算法评估

✅ **合理** - 符合标准 SCL-90 计分方法

**优点：**
- 使用均分而非总分，便于不同维度间比较
- 阈值设置合理（2.0 和 3.0 是 SCL-90 的常用分界点）
- 计算逻辑清晰，易于理解

**建议：**
- 当前实现已经符合标准，无需修改

---

## 二、ADHD 算法分析（简化版 45 题）

### 当前实现

```typescript
// 维度得分计算
维度得分 = 该维度所有题目得分总和（不是均分）

// 维度标签判断
平均分 = 维度得分 ÷ 该维度题目数
< 1.5：偏低
1.5-2.5：中等
≥ 2.5：偏高

// 总体倾向等级判断
总平均分 = (注意力得分 + 执行力得分 + 多动得分) ÷ 45
< 1.5：低
1.5-2.5：中
≥ 2.5：高
```

### 题目分布检查

根据 `adhd-questions.ts`：
- **注意力维度**：15 题（1-15）
- **执行力维度**：15 题（16-30）
- **多动维度**：15 题（31-45）

每个维度都是 15 题，分布均匀。

### 算法问题分析

#### 问题 1：维度得分存储方式不一致

**当前实现：**
- `dimension_scores` 存储的是**总分**（例如：attention: 30）
- 但判断标签时用的是**平均分**（30 ÷ 15 = 2.0）

**影响：**
- 数据库存储的是总分，但显示和判断用的是平均分
- 可能导致混淆

**建议：**
- 方案 A：存储平均分（推荐）
  ```typescript
  dimension_scores: {
    attention: 2.0,  // 平均分
    execution: 1.8,
    hyperactivity: 1.5
  }
  ```
- 方案 B：同时存储总分和平均分
  ```typescript
  dimension_scores: {
    attention: { total: 30, average: 2.0 }
  }
  ```

#### 问题 2：阈值设置缺乏科学依据

**当前阈值：**
- 维度标签：< 1.5 偏低，1.5-2.5 中等，≥ 2.5 偏高
- 总体等级：< 1.5 低，1.5-2.5 中，≥ 2.5 高

**问题：**
- 这些阈值是**经验值**，缺乏科学依据
- 简化版 45 题不是标准量表，没有官方阈值

**参考标准（完整版 ASRS v1.1）：**
- ASRS 总分 ≥ 24 分（0-72 分）：提示高度一致
- 但这是 18 题的阈值，不适用于 45 题简化版

**建议：**
- 保持当前阈值（作为经验值）
- 在结果页明确说明："结果仅供参考，不构成医学诊断"
- 如果后续需要更准确的评估，建议使用完整版（18+25 题）

#### 问题 3：总体倾向等级计算方式

**当前实现：**
```typescript
总平均分 = (注意力得分 + 执行力得分 + 多动得分) ÷ 45
```

**分析：**
- 这个计算方式**合理**
- 相当于：总平均分 = 45题总分 ÷ 45
- 与 SCL-90 的计算方式一致

**建议：**
- 保持当前实现

---

## 三、算法优化建议

### 建议 1：统一维度得分存储方式（推荐）

**修改 `adhd-calculator.ts`：**

```typescript
/**
 * 计算维度得分（改为存储平均分）
 */
function calculateDimensionScores(answers: AnswerData[]) {
  const dimensionTotals: Record<string, { total: number; count: number }> = {
    attention: { total: 0, count: 0 },
    execution: { total: 0, count: 0 },
    hyperactivity: { total: 0, count: 0 },
  };

  answers.forEach((answer) => {
    dimensionTotals[answer.dimension].total += answer.score;
    dimensionTotals[answer.dimension].count += 1;
  });

  // 返回平均分（保留2位小数）
  return {
    attention: Number((dimensionTotals.attention.total / dimensionTotals.attention.count).toFixed(2)),
    execution: Number((dimensionTotals.execution.total / dimensionTotals.execution.count).toFixed(2)),
    hyperactivity: Number((dimensionTotals.hyperactivity.total / dimensionTotals.hyperactivity.count).toFixed(2)),
  };
}
```

**优点：**
- 存储和显示一致，避免混淆
- 便于后续分析和比较
- 与 SCL-90 的存储方式一致

### 建议 2：优化维度标签判断逻辑

**当前实现问题：**
- 使用固定的题目数（15）计算平均分
- 如果题目分布变化，需要手动修改

**优化后：**
```typescript
function getDimensionLabel(
  dimensionScore: number,  // 改为平均分
  totalQuestions: number
): '偏低' | '中等' | '偏高' {
  // 直接使用平均分判断，不需要再除以题目数
  if (dimensionScore < 1.5) return '偏低';
  if (dimensionScore < 2.5) return '中等';
  return '偏高';
}
```

### 建议 3：添加算法说明文档

在结果页或帮助文档中说明：
- 计分方法
- 阈值来源
- 结果解释的局限性

---

## 四、算法合理性总结

### SCL-90 ✅ 合理
- 符合标准计分方法
- 阈值设置合理
- 无需修改

### ADHD（简化版）⚠️ 需要优化

**当前问题：**
1. ❌ 维度得分存储的是总分，但判断用的是平均分（不一致）
2. ⚠️ 阈值是经验值，缺乏科学依据（但可接受，因为是简化版）
3. ✅ 总体倾向等级计算方式合理

**建议优先级：**
1. **高优先级**：统一维度得分存储方式（存储平均分）
2. **中优先级**：优化代码逻辑，使计算更清晰
3. **低优先级**：添加算法说明文档

---

## 五、具体优化方案

### 方案 A：存储平均分（推荐）

**优点：**
- 存储和显示一致
- 便于理解和比较
- 与 SCL-90 保持一致

**实现：**
- 修改 `calculateDimensionScores` 函数，返回平均分
- 修改 `getDimensionLabel` 函数，直接使用平均分判断
- 更新数据库字段说明（如果需要）

### 方案 B：保持当前实现，添加说明

**优点：**
- 不需要修改现有代码
- 快速实现

**缺点：**
- 存储和显示不一致，可能造成混淆

---

## 六、建议

**推荐采用方案 A**，原因：
1. 提高代码可维护性
2. 避免数据混淆
3. 与 SCL-90 保持一致
4. 便于后续扩展

**实施步骤：**
1. 修改 `adhd-calculator.ts` 中的 `calculateDimensionScores` 函数
2. 修改 `getDimensionLabel` 函数
3. 更新类型定义（如果需要）
4. 测试验证

---

最后更新时间：2026-01-01



