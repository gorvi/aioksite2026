# SCL-90 标准版更新说明

## 📋 更新概览

本次更新将项目中的 SCL-90 量表从**自定义版本**升级为**标准版本**，确保与临床使用的标准 SCL-90 症状自评量表完全一致。

## 🎯 主要变更

### 1. 评分体系变更 ⭐

**旧版本（错误）：**
- 评分范围：1-5分
- 选项：(1)没有、(2)很轻、(3)中等、(4)偏重、(5)严重

**新版本（标准）：**
- 评分范围：**0-4分**
- 选项：(0)没有、(1)很轻、(2)中等、(3)偏重、(4)严重

**影响：**
- 所有分数计算降低约20%（因为0-4比1-5少1分）
- 阈值调整：稳定<1.5，压力1.5-2.5，明显≥2.5

### 2. 题目分布变更 ⭐

**旧版本（错误）：**
- 题目按维度连续排列（1-12身体不适，13-22反复想法...）
- 所有90题都计入因子分

**新版本（标准）：**
- **题目打乱分布**（符合标准SCL-90编排）
- **9个因子**（共83题）+ **7个附加项**（不计入因子分）
- 附加项：19, 44, 59, 60, 64, 66, 89（评估睡眠、饮食等）

### 3. 因子题目数量

| 因子 | 题目数 | 题号 |
|------|--------|------|
| 躯体化 | 12 | 1, 4, 12, 27, 40, 42, 48, 49, 52, 53, 56, 58 |
| 强迫症状 | 10 | 3, 9, 10, 28, 38, 45, 46, 51, 55, 65 |
| 人际关系敏感 | 9 | 6, 21, 34, 36, 37, 41, 61, 69, 73 |
| 抑郁 | 13 | 5, 14, 15, 20, 22, 26, 29, 30, 31, 32, 54, 71, 79 |
| 焦虑 | 10 | 2, 17, 23, 33, 39, 57, 72, 78, 80, 86 |
| 敌对 | 6 | 11, 24, 63, 67, 74, 81 |
| 恐怖 | 7 | 13, 25, 47, 50, 70, 75, 82 |
| 偏执 | 6 | 8, 18, 43, 68, 76, 83 |
| 精神病性 | 10 | 7, 16, 35, 62, 77, 84, 85, 87, 88, 90 |

### 4. 计算指标变更

**新增指标：**
- `positive_items_count`：阳性项目数（得分≥2）
- `positive_items_average`：阳性症状均分
- `additional_items_scores`：附加项各题得分
- `additional_items_total`：附加项总分
- `additional_items_average`：附加项均分

**移除指标：**
- `attention_items_count`：已更名为 `positive_items_count`
- `normal_items_count`：已移除
- `attention_items_average`：已更名为 `positive_items_average`

### 5. 维度名称变更

| 旧名称 | 新名称（标准） |
|--------|---------------|
| 身体不适 | **躯体化** |
| 反复想法与行为 | **强迫症状** |
| 人际敏感 | **人际关系敏感** |
| 情绪低落 | **抑郁** |
| 紧张与不安 | **焦虑** |
| 易怒与敌意 | **敌对** |
| 恐惧与回避 | **恐怖** |
| 多疑与不信任 | **偏执** |
| 疏离与异常体验 | **精神病性** |

## 📁 文件变更清单

### 新增文件

```
src/lib/data/scl90-standard-mapping.ts    # 标准因子映射
src/lib/data/scl90-questions-standard.ts  # 标准题目（90题）
src/lib/utils/scl90-calculator-standard.ts # 标准计算器
scripts/validate-scl90-standard.ts        # 验证脚本
```

### 修改文件

```
src/lib/data/scl90-questions.ts           # 改为重导出标准版
src/lib/utils/scl90-calculator.ts         # 改为重导出标准版
src/lib/constants/index.ts                # 更新评分阈值
src/types/index.ts                        # 更新类型定义（0-4分）
src/app/scl90/quiz/page.tsx               # 支持0-4分选项
src/app/scl90/confirm/page.tsx            # 支持0-4分类型
src/app/dev/test/page.tsx                 # 测试工具支持0-4分
```

## ✅ 验证结果

运行 `npm run tsx scripts/validate-scl90-standard.ts`，所有测试通过：

- ✅ 因子映射完整性：9个因子（83题）+ 7个附加项 = 90题
- ✅ 题目完整性：90道题目，编号连续，因子分配正确
- ✅ 因子题目数量：与标准SCL-90一致
- ✅ 计算结果验证：总分、均分、状态判断、因子分均正确
- ✅ 边界值测试：最低分（0）和最高分（4）计算正确

## 🔄 数据库迁移

### 注意事项

⚠️ **重要**：现有数据库中的旧数据（1-5分制）与新数据（0-4分制）**不兼容**！

### 建议处理方案

#### 方案1：清空旧数据（推荐用于开发/测试环境）

```sql
-- 清空所有测试记录
TRUNCATE TABLE scl90_answers;
TRUNCATE TABLE scl90_tests;
```

#### 方案2：保留旧数据（生产环境）

如果生产环境已有用户数据，建议：

1. **添加版本字段**：

```sql
ALTER TABLE scl90_tests 
ADD COLUMN version VARCHAR(10) DEFAULT 'v2' COMMENT '量表版本：v1=1-5分制，v2=0-4分制（标准版）';
```

2. **标记现有数据为v1**：

```sql
UPDATE scl90_tests SET version = 'v1' WHERE version IS NULL;
```

3. **前端适配**：
   - 结果页面根据 `version` 字段显示不同说明
   - v1数据显示"历史版本"标记
   - v2数据显示"标准版"标记

#### 方案3：数据转换（谨慎使用）

理论上可以通过 `(旧分数 - 1) = 新分数` 转换，但**不推荐**：
- 语义不完全对应（旧"1=没有"变成新"0=没有"）
- 可能影响历史数据的准确性

## 🚀 部署步骤

### 1. 本地测试

```bash
# 运行验证脚本
npx tsx scripts/validate-scl90-standard.ts

# 启动开发服务器
npm run dev

# 测试流程
1. 访问 /scl90/nickname 开始测试
2. 填写90题（注意评分是0-4）
3. 查看结果页面
4. 验证因子分、总分、阳性项目数等指标
```

### 2. 数据库处理

```bash
# 登录服务器
ssh root@your-server

# 连接数据库
mysql -u many_ceshi -p many_ceshi

# 执行迁移方案（根据实际选择）
# 方案1：清空数据
TRUNCATE TABLE scl90_answers;
TRUNCATE TABLE scl90_tests;

# 或方案2：添加版本字段
ALTER TABLE scl90_tests ADD COLUMN version VARCHAR(10) DEFAULT 'v2';
UPDATE scl90_tests SET version = 'v1' WHERE version IS NULL;
```

### 3. 部署代码

```bash
# 推送到GitHub
git add .
git commit -m "feat: 升级为标准SCL-90量表（0-4分制）"
git push origin main

# GitHub Actions会自动部署到服务器
```

### 4. 验证部署

- 访问线上环境
- 完成一次完整测试
- 检查数据库中的数据格式
- 验证结果计算是否正确

## 📖 使用注意事项

### 1. 前端UI调整

评分按钮显示可能需要微调：
- 确保"0 = 没有"清晰可见
- 第一个选项不要被误认为是"未选择"

### 2. 结果解读调整

由于评分范围变化，结果解读需要更新：
- 旧版"总分<2.0"对应新版"总分<1.5"
- 旧版"阈值2.0"对应新版"阈值1.5"

### 3. 文档更新

确保更新以下文档：
- 用户指南
- 测试说明
- 结果解读说明

## 🎓 标准SCL-90参考

本次更新完全基于标准 SCL-90 症状自评量表：
- 评分：0-4分制
- 题目：90题（9因子83题 + 7附加项）
- 计分：因子分 = 因子题目总分 ÷ 题目数
- 总分：90题总分
- 总均分：总分 ÷ 90

## ✅ 完成标志

- [x] 评分选项更新为0-4分
- [x] 题目顺序按标准SCL-90打乱
- [x] 因子映射与标准一致
- [x] 附加项单独处理
- [x] 计算器逻辑更新
- [x] 前端组件支持0-4分
- [x] 类型定义更新
- [x] 验证测试全部通过
- [ ] 数据库迁移（待部署时执行）
- [ ] 线上验证（待部署后）

---

**更新日期**：2026-01-06  
**版本**：v2.0.0（标准SCL-90）  
**向后兼容性**：❌ 不兼容（评分体系变更）

