name: Deploy to Tencent Cloud

on:
  push:
    branches:
      - main  # 监听 main 分支的推送
  workflow_dispatch: # 允许手动触发

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy via SSH
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USER }}
          password: ${{ secrets.SERVER_PASSWORD }} # 如果使用密码登录
          # key: ${{ secrets.SERVER_SSH_KEY }}     # 如果使用私钥登录，任选其一
          script: |
            cd /www/wwwroot/aioksite2026
            git pull origin main
            npm install
            # 这里的构建步骤可能需要较多内存，轻量服务器建议 2G 内存以上
            npm run build
            # 这里的名字要和你在宝塔里起的 Node 项目名一致，或者直接用 pm2 管理
            pm2 restart aiok-site || pm2 start npm --name "aiok-site" -- start
